<div class="container">
  <h1>Kafka Streams Pause-Aware Control Panel</h1>

  <!-- Topic Selection -->
  <div class="section">
    <h2>Topic Selection</h2>
    <div class="form-group">
      <label for="topicSelect">Select Topic:</label>
      <select id="topicSelect" [(ngModel)]="selectedTopicId" (change)="onTopicChange()">
        <option *ngFor="let topic of topics" [value]="topic">{{ topic }}</option>
      </select>
    </div>
  </div>

  <!-- Producer Section -->
  <div class="section">
    <h2>Send Events</h2>
    <div class="form-group">
      <label for="producerKey">Key:</label>
      <input 
        id="producerKey" 
        type="text" 
        [(ngModel)]="producerKey" 
        placeholder="Enter event key (e.g., A, B)"
      />
    </div>
    <div class="form-group">
      <label for="producerData">Data:</label>
      <input 
        id="producerData" 
        type="text" 
        [(ngModel)]="producerData" 
        placeholder="Enter event data (e.g., Hello 1)"
      />
    </div>
    <button class="btn-primary" (click)="sendEvent()">Send Event</button>
  </div>

  <!-- Control Section -->
  <div class="section">
    <h2>Pause/Resume Control</h2>
    <div class="form-group">
      <label for="controlKey">Key:</label>
      <input 
        id="controlKey" 
        type="text" 
        [(ngModel)]="controlKey" 
        placeholder="Enter key to pause/resume (e.g., A)"
      />
    </div>
    <button class="btn-warning" (click)="pause()">Pause Key</button>
    <button class="btn-success" (click)="resume()">Resume Key</button>
  </div>

  <!-- Dashboard Controls -->
  <div class="section" style="background: #e3f2fd; border-left: 5px solid #2196f3;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <h2>Dashboard</h2>
      <div>
        <label style="margin-right: 15px;">
          <input type="checkbox" [(ngModel)]="autoRefresh" (change)="toggleAutoRefresh()" />
          Auto-Refresh (2s)
        </label>
        <button class="btn-primary" (click)="refreshDashboard()" [disabled]="isLoading">
          {{ isLoading ? 'Refreshing...' : 'Refresh Now' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Key Status & Buffer (Dependent on Control Key) -->
  <div class="section" *ngIf="controlKey">
     <h2>Key Status & Buffer: {{ controlKey }}</h2>
     <div style="display: flex; gap: 20px;">
        <div class="card" [ngClass]="{'status-active': keyStatus === 'ACTIVE', 'status-paused': keyStatus === 'PAUSED'}">
           <h3>Status</h3>
           <div class="status-value">{{ keyStatus }}</div>
        </div>
        <div class="card">
           <h3>Buffered Events</h3>
           <div class="status-value">{{ bufferedEvents.length }}</div>
        </div>
     </div>
     
     <div *ngIf="bufferedEvents.length > 0" style="margin-top: 15px;">
        <h4>Buffered Events List</h4>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Event ID</th>
                        <th>Data</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let event of bufferedEvents">
                        <td>{{ event.id }}</td>
                        <td>{{ event.data }}</td>
                        <td>{{ event.timestamp | date:'HH:mm:ss.SSS' }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
     </div>
  </div>

  <div style="display: flex; gap: 20px;">
      <!-- Input Topic -->
      <div class="section" style="flex: 1;">
        <h2>Input Topic ({{ selectedTopicId }}-in)</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Key</th>
                        <th>Data</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let msg of inputMessages">
                        <td>{{ msg.key }}</td>
                        <td>{{ msg.data }}</td>
                        <td>{{ msg.timestamp | date:'HH:mm:ss' }}</td>
                    </tr>
                    <tr *ngIf="inputMessages.length === 0">
                        <td colspan="3">No recent messages</td>
                    </tr>
                </tbody>
            </table>
        </div>
      </div>

      <!-- Output Topic -->
      <div class="section" style="flex: 1;">
        <h2>Output Topic ({{ selectedTopicId }}-out)</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Key</th>
                        <th>Data</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let msg of outputMessages">
                        <td>{{ msg.key }}</td>
                        <td>{{ msg.data }}</td>
                        <td>{{ msg.timestamp | date:'HH:mm:ss' }}</td>
                    </tr>
                    <tr *ngIf="outputMessages.length === 0">
                        <td colspan="3">No recent messages</td>
                    </tr>
                </tbody>
            </table>
        </div>
      </div>
  </div>

  <!-- Status/Log Panel -->
  <div class="section">
    <h2>Activity Log</h2>
    <button class="btn-danger" (click)="clearLogs()">Clear Logs</button>
    <div class="status-panel">
      <div *ngIf="logs.length === 0" class="log-entry info">
        No activity yet. Start by sending events or pausing/resuming keys.
      </div>
      <div 
        *ngFor="let log of logs" 
        class="log-entry {{ log.type }}"
      >
        [{{ log.timestamp | date:'HH:mm:ss' }}] {{ log.message }}
      </div>
    </div>
  </div>
</div>

